#!/bin/bash
# /// @author	Marc Hanheide (mhanheid@TechFak.Uni-Bielefeld.de)
# /// @date	started at 2005/03/04
# /// @version	$Id: vdemo2,v 1.3 2007/08/17 15:28:46 mhanheid Exp $
RCS_ID='$Id: vdemo2,v 1.3 2007/08/17 15:28:46 mhanheid Exp $'
SCRIPTNAME=${0##*/}

USAGE="\
usage: $SCRIPTNAME [options] <Config file>
  for further help invoke '$SCRIPTNAME -h'
"

HELP="\
usage: $SCRIPTNAME [options] <Config file>

vdemo starter

 options:
  -h  --help           this help text
  -a  --auto           automatically start all components
  -r  --logrotate      enable log rotation
  -v  --verbose [level]    set verbosity [level]
                           >0: increasing verbosity
                           -1: also suppress message boxes
  -Q  --quit <components>  space separated list of components to quit vdemo on

 authors: Marc Hanheide, Robert Haschke
"

# exit script on all non-zero return values
set -e

# option checks
while [ $# -gt 0 ]; do
    case $1 in
    "-h"|"--help")
        echo "$HELP" >& 2
        exit 0
        ;;
    "-a"|"--auto")
        echo "Automatically starting all components"
        export VDEMO_autostart="true"
        ;;
    "-r"|"--logrotate")
        echo "Enable log rotation"
        export LOG_ROTATION="ON"
        export VDEMO_exports="$VDEMO_exports LOG_ROTATION"
        ;;
    "-v"|"--verbose")
        export VDEMO_DEBUG_LEVEL=1
        if [[ $2 =~ ^-?[0-9]+$ ]] ; then
            export VDEMO_DEBUG_LEVEL=$2
            shift
        fi
        echo "Using verbosity level $VDEMO_DEBUG_LEVEL"
        ;;
    "-Q"|"--quit")
        export VDEMO_QUIT_COMPONENTS=$2
        shift
        ;;
    -*)
        echo "illegal option $1" >& 2
        echo "$USAGE" >& 2
        exit 1
        ;;
    *)
        break
        ;;
    esac
    shift
done

# obligatory arguments check
if [ $# -lt 1 ]; then
    echo "obligatory argument(s) missing. $USAGE" >&2 
    exit 1
fi

export VDEMO_root="@VDEMO_root@"

export VDEMO_demoConfig="$1"
if [[ "$1" != /* ]]; then VDEMO_demoConfig=$(pwd)/$1; fi

source "$VDEMO_demoConfig"

export VDEMO_exports="SPREAD_CONFIG $VDEMO_exports"

exec $VDEMO_root/vdemo2_controller.tcl
